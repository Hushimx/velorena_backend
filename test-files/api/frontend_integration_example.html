<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>External Design API Integration Example</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }

            .container {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .search-form {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }

            .search-form input,
            .search-form select {
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
            }

            .search-form input[type="text"] {
                flex: 1;
                min-width: 200px;
            }

            .search-form button {
                padding: 10px 20px;
                background: #007bff;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }

            .search-form button:hover {
                background: #0056b3;
            }

            .results-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }

            .design-card {
                border: 1px solid #ddd;
                border-radius: 8px;
                overflow: hidden;
                background: white;
                transition: transform 0.2s;
            }

            .design-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .design-card img {
                width: 100%;
                height: 200px;
                object-fit: cover;
            }

            .design-card-content {
                padding: 15px;
            }

            .design-card h3 {
                margin: 0 0 10px 0;
                font-size: 16px;
                color: #333;
            }

            .design-card p {
                margin: 0 0 10px 0;
                color: #666;
                font-size: 14px;
                line-height: 1.4;
            }

            .design-card .meta {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 12px;
                color: #888;
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: #666;
            }

            .error {
                background: #f8d7da;
                color: #721c24;
                padding: 15px;
                border-radius: 4px;
                margin: 20px 0;
            }

            .pagination {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-top: 20px;
            }

            .pagination button {
                padding: 8px 12px;
                border: 1px solid #ddd;
                background: white;
                cursor: pointer;
                border-radius: 4px;
            }

            .pagination button:hover {
                background: #f8f9fa;
            }

            .pagination button.active {
                background: #007bff;
                color: white;
                border-color: #007bff;
            }

            .categories {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-bottom: 20px;
            }

            .category-tag {
                padding: 5px 10px;
                background: #e9ecef;
                border-radius: 15px;
                cursor: pointer;
                font-size: 12px;
                transition: background 0.2s;
            }

            .category-tag:hover {
                background: #dee2e6;
            }

            .category-tag.active {
                background: #007bff;
                color: white;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>External Design API Integration Example</h1>
            <p>
                This example demonstrates how to integrate with the protected
                External Design API endpoints.
            </p>

            <!-- Search Form -->
            <div class="search-form">
                <input
                    type="text"
                    id="searchQuery"
                    placeholder="Search for designs..."
                    value="business"
                />
                <select id="designType">
                    <option value="">All Types</option>
                    <option value="photo">Photo</option>
                    <option value="vector">Vector</option>
                    <option value="psd">PSD</option>
                    <option value="ai">AI</option>
                </select>
                <select id="orientation">
                    <option value="">All Orientations</option>
                    <option value="horizontal">Horizontal</option>
                    <option value="vertical">Vertical</option>
                    <option value="square">Square</option>
                </select>
                <input
                    type="number"
                    id="limit"
                    placeholder="Limit"
                    value="20"
                    min="1"
                    max="100"
                />
                <button onclick="searchDesigns()">Search</button>
                <button onclick="getFeaturedDesigns()">Featured</button>
            </div>

            <!-- Categories -->
            <div id="categories" class="categories">
                <div class="loading">Loading categories...</div>
            </div>

            <!-- Results -->
            <div id="results">
                <div class="loading">Click search to get started...</div>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="pagination" style="display: none"></div>
        </div>

        <script>
            // API Base URL - Update this to match your Laravel application
            const API_BASE_URL = "/api/external/designs";

            let currentPage = 1;
            let currentFilters = {};

            // Initialize the page
            document.addEventListener("DOMContentLoaded", function () {
                loadCategories();
            });

            // Load available categories
            async function loadCategories() {
                try {
                    const response = await fetch(`${API_BASE_URL}/categories`);
                    const data = await response.json();

                    if (data.success) {
                        const categoriesDiv =
                            document.getElementById("categories");
                        categoriesDiv.innerHTML = "";

                        data.data.forEach((category) => {
                            const tag = document.createElement("div");
                            tag.className = "category-tag";
                            tag.textContent = category.name;
                            tag.onclick = () =>
                                getDesignsByCategory(category.id);
                            categoriesDiv.appendChild(tag);
                        });
                    } else {
                        document.getElementById("categories").innerHTML =
                            '<div class="error">Failed to load categories: ' +
                            data.message +
                            "</div>";
                    }
                } catch (error) {
                    document.getElementById("categories").innerHTML =
                        '<div class="error">Error loading categories: ' +
                        error.message +
                        "</div>";
                }
            }

            // Search designs
            async function searchDesigns() {
                const query = document
                    .getElementById("searchQuery")
                    .value.trim();
                if (!query) {
                    alert("Please enter a search query");
                    return;
                }

                const filters = {
                    q: query,
                    limit:
                        parseInt(document.getElementById("limit").value) || 20,
                    page: currentPage,
                };

                const type = document.getElementById("designType").value;
                const orientation =
                    document.getElementById("orientation").value;

                if (type) filters.type = type;
                if (orientation) filters.orientation = orientation;

                currentFilters = filters;
                await performSearch(filters);
            }

            // Get designs by category
            async function getDesignsByCategory(categoryId) {
                const filters = {
                    category: categoryId,
                    limit:
                        parseInt(document.getElementById("limit").value) || 20,
                    page: currentPage,
                };

                const type = document.getElementById("designType").value;
                const orientation =
                    document.getElementById("orientation").value;

                if (type) filters.type = type;
                if (orientation) filters.orientation = orientation;

                currentFilters = filters;
                await performCategorySearch(filters);
            }

            // Get featured designs
            async function getFeaturedDesigns() {
                const filters = {
                    limit:
                        parseInt(document.getElementById("limit").value) || 20,
                    page: currentPage,
                };

                const type = document.getElementById("designType").value;
                const orientation =
                    document.getElementById("orientation").value;

                if (type) filters.type = type;
                if (orientation) filters.orientation = orientation;

                currentFilters = filters;
                await performFeaturedSearch(filters);
            }

            // Perform search
            async function performSearch(filters) {
                try {
                    showLoading();

                    const params = new URLSearchParams(filters);
                    const response = await fetch(
                        `${API_BASE_URL}/search?${params}`
                    );
                    const data = await response.json();

                    if (data.success) {
                        displayResults(data.data, data.pagination);
                    } else {
                        showError("Search failed: " + data.message);
                    }
                } catch (error) {
                    showError("Error searching designs: " + error.message);
                }
            }

            // Perform category search
            async function performCategorySearch(filters) {
                try {
                    showLoading();

                    const params = new URLSearchParams(filters);
                    const response = await fetch(
                        `${API_BASE_URL}/category?${params}`
                    );
                    const data = await response.json();

                    if (data.success) {
                        displayResults(data.data, data.pagination);
                    } else {
                        showError("Category search failed: " + data.message);
                    }
                } catch (error) {
                    showError("Error searching by category: " + error.message);
                }
            }

            // Perform featured search
            async function performFeaturedSearch(filters) {
                try {
                    showLoading();

                    const params = new URLSearchParams(filters);
                    const response = await fetch(
                        `${API_BASE_URL}/featured?${params}`
                    );
                    const data = await response.json();

                    if (data.success) {
                        displayResults(data.data, data.pagination);
                    } else {
                        showError("Featured search failed: " + data.message);
                    }
                } catch (error) {
                    showError(
                        "Error getting featured designs: " + error.message
                    );
                }
            }

            // Display search results
            function displayResults(designs, pagination) {
                const resultsDiv = document.getElementById("results");

                if (designs.length === 0) {
                    resultsDiv.innerHTML =
                        '<div class="loading">No designs found.</div>';
                    return;
                }

                let html = '<div class="results-grid">';

                designs.forEach((design) => {
                    html += `
                    <div class="design-card">
                        <img src="${
                            design.thumbnail_url ||
                            design.image_url ||
                            "https://via.placeholder.com/250x200"
                        }"
                             alt="${design.title}"
                             onerror="this.src='https://via.placeholder.com/250x200'">
                        <div class="design-card-content">
                            <h3>${design.title}</h3>
                            <p>${
                                design.description || "No description available"
                            }</p>
                            <div class="meta">
                                <span>${design.type || "Unknown"}</span>
                                <span>${design.orientation || "Unknown"}</span>
                            </div>
                        </div>
                    </div>
                `;
                });

                html += "</div>";
                resultsDiv.innerHTML = html;

                // Display pagination
                displayPagination(pagination);
            }

            // Display pagination
            function displayPagination(pagination) {
                const paginationDiv = document.getElementById("pagination");

                if (pagination.total_pages <= 1) {
                    paginationDiv.style.display = "none";
                    return;
                }

                paginationDiv.style.display = "flex";

                let html = "";

                // Previous button
                if (pagination.current_page > 1) {
                    html += `<button onclick="changePage(${
                        pagination.current_page - 1
                    })">Previous</button>`;
                }

                // Page numbers
                const startPage = Math.max(1, pagination.current_page - 2);
                const endPage = Math.min(
                    pagination.total_pages,
                    pagination.current_page + 2
                );

                for (let i = startPage; i <= endPage; i++) {
                    const activeClass =
                        i === pagination.current_page ? "active" : "";
                    html += `<button class="${activeClass}" onclick="changePage(${i})">${i}</button>`;
                }

                // Next button
                if (pagination.current_page < pagination.total_pages) {
                    html += `<button onclick="changePage(${
                        pagination.current_page + 1
                    })">Next</button>`;
                }

                paginationDiv.innerHTML = html;
            }

            // Change page
            function changePage(page) {
                currentPage = page;
                currentFilters.page = page;

                if (currentFilters.q) {
                    performSearch(currentFilters);
                } else if (currentFilters.category) {
                    performCategorySearch(currentFilters);
                } else {
                    performFeaturedSearch(currentFilters);
                }
            }

            // Show loading state
            function showLoading() {
                document.getElementById("results").innerHTML =
                    '<div class="loading">Loading designs...</div>';
                document.getElementById("pagination").style.display = "none";
            }

            // Show error message
            function showError(message) {
                document.getElementById(
                    "results"
                ).innerHTML = `<div class="error">${message}</div>`;
                document.getElementById("pagination").style.display = "none";
            }

            // Handle Enter key in search input
            document
                .getElementById("searchQuery")
                .addEventListener("keypress", function (e) {
                    if (e.key === "Enter") {
                        searchDesigns();
                    }
                });
        </script>
    </body>
</html>
